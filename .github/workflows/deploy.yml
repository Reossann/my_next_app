name: Deploy to Render

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # --- ğŸ¦ ã“ã“ã‹ã‚‰è¿½åŠ ã‚¨ãƒªã‚¢ ---
      
      # 1. Node.js (JavaScriptã‚’å‹•ã‹ã™ç’°å¢ƒ) ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 2. å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install Dependencies
        run: npm install

      # 3. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ (ã“ã“ã§å¤±æ•—ã—ãŸã‚‰ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯é€²ã¾ãšæ­¢ã¾ã‚Šã¾ã™)
      - name: Run Tests
        run: npm test

      # --- ğŸ¦ ã“ã“ã¾ã§è¿½åŠ ã‚¨ãƒªã‚¢ ---

      - name: Trigger Render Deploy
        if: success() # ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ãŸæ™‚ã ã‘å®Ÿè¡Œã™ã‚‹
        run: curl -X POST ${{ secrets.RENDER_DEPLOY_HOOK }}